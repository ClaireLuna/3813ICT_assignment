<div class="container mt-4">
  <div class="card" style="max-height: 80vh">
    <div class="card-header">
      <h3>Chat Channel</h3>
    </div>
    <div
      class="card-body"
      style="
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column-reverse;
      "
    >
      <div class="messages">
        <div *ngFor="let message of messages" class="message mb-2">
          <strong
            [ngClass]="{ 'text-primary': message.user.id === currentUserId }"
          >
            {{ message.user.username }}:
          </strong>
          <ng-container *ngIf="message.content; else imageTemplate">
            {{ message.content }}
          </ng-container>
          <ng-template #imageTemplate>
            <br />
            <img
              *ngIf="message.image"
              [src]="message.image"
              alt="Image"
              class="img-fluid"
              style="max-width: 50%"
            />
          </ng-template>
        </div>
      </div>
    </div>
    <div class="card-footer">
      <form (ngSubmit)="sendMessage()">
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            [(ngModel)]="newMessage"
            name="message"
            placeholder="Type a message..."
            required
          />
          <div class="input-group-append">
            <button
              class="btn btn-secondary"
              data-bs-toggle="modal"
              data-bs-target="#imageModal"
              type="button"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 512 512"
                style="width: 1em; height: 1em; vertical-align: -0.125em"
              >
                <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                <path
                  d="M149.1 64.8L138.7 96 64 96C28.7 96 0 124.7 0 160L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-256c0-35.3-28.7-64-64-64l-74.7 0L362.9 64.8C356.4 45.2 338.1 32 317.4 32L194.6 32c-20.7 0-39 13.2-45.5 32.8zM256 192a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"
                />
              </svg>
            </button>
            <button class="btn btn-primary" type="submit">Send</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Image Upload Modal -->
<div
  class="modal fade"
  id="imageModal"
  tabindex="-1"
  aria-labelledby="imageModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imageModalLabel">Upload Image</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <input
          type="file"
          accept="image/*"
          (change)="onImageSelected($event)"
        />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="sendImage()"
          data-bs-toggle="modal"
          data-bs-target="#imageModal"
        >
          Send Image
        </button>
      </div>
    </div>
  </div>
</div>
